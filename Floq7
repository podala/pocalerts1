sequenceDiagram
    autonumber

    participant User as ğŸ–¥ï¸ User (React)
    participant Gateway as ğŸ”‘ API Gateway (JWT Validation & Rate Limiting)
    participant DropDownService as ğŸ›ï¸ Drop Down Service (Spring Boot GraphQL)
    participant SearchService as ğŸ” Search Service (Spring Boot GraphQL)
    participant PDFViewService as ğŸ“„ PDF View Service (Spring Boot GraphQL)
    participant UpdateService as ğŸ”„ Update Service (Spring Boot GraphQL)
    participant Database as ğŸ—„ï¸ SQL Server

    %% User logs in and generates a JWT Token (Only Once)
    User->>Gateway: Request login credentials
    Gateway->>Gateway: Validate User & Generate JWT Token
    Gateway-->>User: âœ… Return JWT Token

    %% User sends API requests with the same JWT Token
    User->>Gateway: Call Drop Down/Search/PDF/Update Service (with JWT)
    Gateway->>Gateway: Validate JWT Token (No New Auth Calls)

    %% Token Validation Handling
    alt âŒ Invalid JWT Token
        Gateway-->>User: âŒ Return 401 Unauthorized
    else
        %% Rate Limiting Check
        alt âŒ Exceeded API Rate Limit
            Gateway-->>User: âŒ Return 429 Too Many Requests
        else
            %% Routing to Respective Services

            %% Drop Down Service
            Gateway->>DropDownService: Forward Request (Dropdown)
            alt âŒ DropDownService Down (Circuit Breaker Tripped)
                DropDownService-->>Gateway: âŒ Return 503 Service Unavailable
                Gateway-->>User: âŒ Return 503 Too Many Requests
            else
                DropDownService->>Database: Fetch Dropdown Data
                Database-->>DropDownService: âœ… Return Data / âŒ 5XX Database Error
                alt âŒ 5XX Database Error
                    DropDownService-->>Gateway: âŒ Return 5XX Internal Server Error
                    Gateway-->>User: âŒ Return 5XX Internal Server Error
                else
                    DropDownService-->>Gateway: âœ… Return Data
                    Gateway-->>User: âœ… Return Data
                end
            end

            %% Search Service
            Gateway->>SearchService: Forward Request (Search)
            alt âŒ SearchService Timeout
                SearchService-->>Gateway: âŒ Return 504 Gateway Timeout
                Gateway-->>User: âŒ Return 504 Timeout
            else
                SearchService->>Database: Query Search Data
                Database-->>SearchService: âœ… Return Data / âŒ 5XX Database Error
                alt âŒ 5XX Database Error
                    SearchService-->>Gateway: âŒ Return 5XX Internal Server Error
                    Gateway-->>User: âŒ Return 5XX Internal Server Error
                else
                    SearchService-->>Gateway: âœ… Return Data
                    Gateway-->>User: âœ… Return Data
                end
            end

            %% PDF View Service
            Gateway->>PDFViewService: Forward Request (PDF Data)
            alt âŒ PDF Service Crash (Circuit Breaker Tripped)
                PDFViewService-->>Gateway: âŒ Return 503 Service Unavailable
                Gateway-->>User: âŒ Return 503 Too Many Requests
            else
                PDFViewService->>Database: Retrieve Data
                Database-->>PDFViewService: âœ… Return Data / âŒ 4XX Not Found
                alt âŒ 4XX Not Found
                    PDFViewService-->>Gateway: âŒ Return 404 Not Found
                    Gateway-->>User: âŒ Return 404 Data Not Found
                else
                    PDFViewService-->>Gateway: âœ… Return Data
                    Gateway-->>User: âœ… Return Data
                end
            end

            %% Update Service
            Gateway->>UpdateService: Forward Update Request
            alt âŒ Update Service Overloaded (Circuit Breaker Active)
                UpdateService-->>Gateway: âŒ Return 503 Service Unavailable
                Gateway-->>User: âŒ Return 503 Too Many Requests
            else
                UpdateService->>Database: Update Data
                Database-->>UpdateService: âœ… Confirm Update / âŒ 4XX Constraint Violation
                alt âŒ 4XX Constraint Violation
                    UpdateService-->>Gateway: âŒ Return 400 Bad Request
                    Gateway-->>User: âŒ Return 400 Data Validation Error
                else
                    UpdateService-->>Gateway: âœ… Return Success
                    Gateway-->>User: âœ… Return Success
                end
            end
        end
    end
