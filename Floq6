sequenceDiagram
    autonumber

    participant User as ðŸ–¥ï¸ User (React)
    participant Gateway as ðŸ”‘ API Gateway (Authentication & Rate Limiting)
    participant DropDownService as ðŸŽ›ï¸ Drop Down Service (Spring Boot GraphQL)
    participant SearchService as ðŸ” Search Service (Spring Boot GraphQL)
    participant PDFViewService as ðŸ“„ PDF View Service (Spring Boot GraphQL)
    participant UpdateService as ðŸ”„ Update Service (Spring Boot GraphQL)
    participant Database as ðŸ—„ï¸ SQL Server

    %% User sends request with JWT
    User->>Gateway: Call Drop Down/Search/PDF/Update Service (with JWT Token)
    Gateway->>Gateway: Validate JWT Token

    %% JWT Authentication Handling
    alt âŒ Invalid JWT Token
        Gateway-->>User: âŒ Return 401 Unauthorized
    else
        %% Rate Limiting Check
        alt âŒ Exceeded API Rate Limit
            Gateway-->>User: âŒ Return 429 Too Many Requests
        else
            %% If Valid, Route to Respective Service
            Gateway->>DropDownService: Forward Request (Dropdown)
            alt âŒ DropDownService is Down (Circuit Breaker Active)
                DropDownService-->>Gateway: âŒ Return 503 Service Unavailable
                Gateway-->>User: âŒ Return 503 Too Many Requests
            else
                DropDownService->>Database: Fetch Dropdown Data
                Database-->>DropDownService: âœ… Return Data / âŒ Database Failure
                alt âŒ Database Failure
                    DropDownService-->>Gateway: âŒ Return 500 Database Error
                    Gateway-->>User: âŒ Return 500 Internal Server Error
                else
                    DropDownService-->>Gateway: Send Dropdown Response
                    Gateway-->>User: âœ… Return Data
                end
            end
        end
    end

    %% Search Service Flow with Timeout Handling
    alt JWT Token Valid
        Gateway->>SearchService: Forward Request (Search)
        alt âŒ SearchService Timeout
            SearchService-->>Gateway: âŒ Return 504 Gateway Timeout
            Gateway-->>User: âŒ Return 504 Timeout
        else
            SearchService->>Database: Query Search Data
            Database-->>SearchService: âœ… Return Results / âŒ Query Failure
            alt âŒ Query Failure
                SearchService-->>Gateway: âŒ Return 500 Database Error
                Gateway-->>User: âŒ Return 500 Internal Server Error
            else
                SearchService-->>Gateway: Send Search Response
                Gateway-->>User: âœ… Return Data
            end
        end
    end

    %% PDF View Service with Circuit Breaker Protection
    Gateway->>PDFViewService: Forward Request (PDF Metadata)
    alt âŒ PDF Service Crash (Circuit Breaker Tripped)
        PDFViewService-->>Gateway: âŒ Return 503 Circuit Breaker Active
        Gateway-->>User: âŒ Return 503 Too Many Requests
    else
        PDFViewService->>Database: Retrieve PDF Metadata
        Database-->>PDFViewService: âœ… Return Metadata / âŒ Metadata Not Found
        alt âŒ Metadata Not Found
            PDFViewService-->>Gateway: âŒ Return 404 Not Found
            Gateway-->>User: âŒ Return 404 Document Not Found
        else
            PDFViewService-->>Gateway: Send PDF Metadata
            Gateway-->>User: âœ… Return Data
        end
    end

    %% Update Service with Retry Logic & Database Constraint Handling
    Gateway->>UpdateService: Forward Update Request
    alt âŒ Update Service Overloaded (Circuit Breaker Active)
        UpdateService-->>Gateway: âŒ Return 503 Service Unavailable
        Gateway-->>User: âŒ Return 503 Too Many Requests
    else
        UpdateService->>Database: Update PDF Data
        Database-->>UpdateService: âœ… Confirm Update / âŒ Constraint Violation
        alt âŒ Constraint Violation
            UpdateService-->>Gateway: âŒ Return 400 Bad Request
            Gateway-->>User: âŒ Return 400 Data Validation Error
        else
            UpdateService-->>Gateway: Send Success Response
            Gateway-->>User: âœ… Return Success
        end
    end
